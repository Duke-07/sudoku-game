<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sudoku Game - Duke07</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Roboto Mono', monospace;
    }
    .sudoku-cell {
      border: 1px solid #374151;
      text-align: center;
      font-weight: 600;
      font-size: 1.25rem;
      color: #d1d5db;
      background-color: #1f2937;
      outline-offset: -2px;
      outline-color: transparent;
      outline-style: solid;
      outline-width: 2px;
      transition: outline-color 0.2s ease, background-color 0.3s ease, color 0.3s ease;
      -moz-appearance: textfield;
      -webkit-appearance: none;
      position: relative;
      z-index: 0;
    }
    .sudoku-cell:focus {
      outline-color: #3b82f6;
      background-color: #111827;
      color: #60a5fa;
      z-index: 10;
    }
    .border-right-2 {
      border-right-width: 2px !important;
      border-color: #9ca3af !important;
    }
    .border-bottom-2 {
      border-bottom-width: 2px !important;
      border-color: #9ca3af !important;
    }
    .sudoku-cell[readonly] {
      color: #9ca3af;
      background-color: #374151;
      font-weight: 700;
      cursor: default;
    }
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
      -webkit-appearance: none; 
      margin: 0; 
    }
    input[type=number] {
      -moz-appearance: textfield;
    }
    .correct-input:focus {
      background-color: #064e3b !important;
      color: #22c55e !important;
      font-weight: 700;
    }
    .incorrect-input:focus {
      background-color: #7f1d1d !important;
      color: #ef4444 !important;
      font-weight: 700;
    }
    .highlight-row,
    .highlight-col {
      background-color: #facc15 !important;
      color: #78350f !important;
      z-index: 5;
    }
    .highlight-box {
      background-color: #fef3c7 !important;
      color: #78350f !important;
      z-index: 4;
    }
  </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-start py-8 px-4">
  <h1 class="text-4xl font-extrabold text-blue-400 mb-6 select-none">Sudoku Game</h1>

  <div class="w-full max-w-3xl flex flex-col md:flex-row gap-6">
    <section class="flex-1">
      <form id="sudoku-form" class="grid grid-cols-9 gap-0.5 rounded-lg shadow-lg bg-gray-800 p-1 select-none" autocomplete="off" spellcheck="false" aria-label="Sudoku puzzle grid" style="min-width: 360px; min-height: 360px;">
      </form>
    </section>

    <section class="w-full md:w-72 flex flex-col gap-6 text-gray-300">
      <div class="flex flex-col items-center bg-gray-800 rounded-lg p-4 shadow-lg select-none">
        <div class="text-lg font-semibold mb-2">Timer</div>
        <div id="timer" class="text-3xl font-mono text-blue-400">00:00</div>
      </div>

      <div class="flex flex-col items-center bg-gray-800 rounded-lg p-4 shadow-lg">
        <div class="text-lg font-semibold mb-2 select-none">Hints Left</div>
        <button id="hint-btn" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:bg-gray-600 rounded-md px-4 py-2 text-white font-semibold transition-colors" aria-label="Use a hint">
          <i class="fas fa-lightbulb"></i> <span id="hints-left">3</span>
        </button>
      </div>

      <div class="flex flex-col items-center bg-gray-800 rounded-lg p-4 shadow-lg select-none">
        <div class="text-lg font-semibold mb-2">Mistakes</div>
        <div id="mistakes" class="text-3xl font-mono text-red-500">0</div>
      </div>

      <button id="new-game-btn" class="bg-green-600 hover:bg-green-700 active:bg-green-800 rounded-md px-4 py-3 text-white font-bold shadow-lg transition-colors select-none" aria-label="Start a new Sudoku game">
        <i class="fas fa-redo-alt mr-2"></i> New Game
      </button>

      <div id="message" class="text-center text-red-500 font-semibold min-h-[1.5rem] select-none" aria-live="polite" role="alert"></div>
    </section>
  </div>

  <footer class="mt-12 text-gray-500 text-sm select-none flex flex-col items-center gap-1">
    <div>&copy; 2025 Sudoku Game. All rights reserved.</div>
    <div class="text-xs text-gray-400 select-text">Created By - Duke07</div>
  </footer>

  <script>
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function isSafe(board, row, col, num) {
      for (let x = 0; x < 9; x++) {
        if (board[row][x] === num) return false;
        if (board[x][col] === num) return false;
      }
      const startRow = row - (row % 3);
      const startCol = col - (col % 3);
      for (let r = 0; r < 3; r++) {
        for (let c = 0; c < 3; c++) {
          if (board[startRow + r][startCol + c] === num) return false;
        }
      }
      return true;
    }

    function solveSudoku(board) {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (board[row][col] === 0) {
            for (let num = 1; num <= 9; num++) {
              if (isSafe(board, row, col, num)) {
                board[row][col] = num;
                if (solveSudoku(board)) return true;
                board[row][col] = 0;
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    function copyBoard(board) {
      return board.map(row => row.slice());
    }

    function countSolutions(board, limit = 2) {
      let count = 0;
      function backtrack() {
        if (count >= limit) return;
        for (let row = 0; row < 9; row++) {
          for (let col = 0; col < 9; col++) {
            if (board[row][col] === 0) {
              for (let num = 1; num <= 9; num++) {
                if (isSafe(board, row, col, num)) {
                  board[row][col] = num;
                  backtrack();
                  board[row][col] = 0;
                }
              }
              return;
            }
          }
        }
        count++;
      }
      backtrack();
      return count;
    }

    function generateFullBoard() {
      const board = Array.from({ length: 9 }, () => Array(9).fill(0));
      function fillBoard() {
        for (let row = 0; row < 9; row++) {
          for (let col = 0; col < 9; col++) {
            if (board[row][col] === 0) {
              const numbers = shuffle([1,2,3,4,5,6,7,8,9]);
              for (const num of numbers) {
                if (isSafe(board, row, col, num)) {
                  board[row][col] = num;
                  if (fillBoard()) return true;
                  board[row][col] = 0;
                }
              }
              return false;
            }
          }
        }
        return true;
      }
      fillBoard();
      return board;
    }

    function generatePuzzle(fullBoard, clues = 40) {
      const puzzle = copyBoard(fullBoard);
      const cells = [];
      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          cells.push([r, c]);
        }
      }
      shuffle(cells);

      let removed = 0;
      for (const [r, c] of cells) {
        if (81 - removed <= clues) break;
        const backup = puzzle[r][c];
        puzzle[r][c] = 0;

        const solutions = countSolutions(copyBoard(puzzle), 2);
        if (solutions !== 1) {
          puzzle[r][c] = backup;
        } else {
          removed++;
        }
      }
      return puzzle;
    }

    const sudokuForm = document.getElementById('sudoku-form');
    const timerEl = document.getElementById('timer');
    const hintBtn = document.getElementById('hint-btn');
    const hintsLeftEl = document.getElementById('hints-left');
    const newGameBtn = document.getElementById('new-game-btn');
    const messageEl = document.getElementById('message');
    const mistakesEl = document.getElementById('mistakes');

    let solutionBoard = null;
    let puzzleBoard = null;
    let timerInterval = null;
    let secondsElapsed = 0;
    let hintsLeft = 3;
    let mistakes = 0;
    const maxMistakes = 10;

    function createGrid() {
      sudokuForm.innerHTML = '';
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const input = document.createElement('input');
          input.type = 'number';
          input.min = 1;
          input.max = 9;
          input.className = 'sudoku-cell w-10 h-10 md:w-12 md:h-12 leading-none rounded-sm';
          input.setAttribute('inputmode', 'numeric');
          input.setAttribute('aria-label', `Row ${row + 1} Column ${col + 1}`);
          input.id = `cell-${row}-${col}`;
          input.autocomplete = 'off';
          input.spellcheck = false;
          input.pattern = '[1-9]';
          input.maxLength = 1;
          if ((col + 1) % 3 === 0 && col !== 8) {
            input.classList.add('border-right-2');
          }
          if ((row + 1) % 3 === 0 && row !== 8) {
            input.classList.add('border-bottom-2');
          }
          input.addEventListener('keydown', e => {
            if (['ArrowUp', 'ArrowDown'].includes(e.key)) {
              e.preventDefault();
            }
          });
          input.addEventListener('input', e => {
            const val = e.target.value;
            if (!/^[1-9]$/.test(val)) {
              e.target.value = '';
              clearInputStyles(e.target);
              checkCompletion();
              return;
            }
            handleInputChange(e.target, parseInt(val));
          });
          input.addEventListener('focus', e => {
            highlightRelatedCells(e.target);
          });
          input.addEventListener('blur', e => {
            clearHighlights();
          });
          sudokuForm.appendChild(input);
        }
      }
    }

    function clearInputStyles(input) {
      input.classList.remove('correct-input', 'incorrect-input');
    }

    function fillGrid(puzzle) {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const input = document.getElementById(`cell-${row}-${col}`);
          const val = puzzle[row][col];
          input.classList.remove('correct-input', 'incorrect-input');
          if (val !== 0) {
            input.value = val;
            input.readOnly = true;
            input.classList.add('cursor-default');
            input.classList.remove('text-blue-400');
          } else {
            input.value = '';
            input.readOnly = false;
            input.classList.remove('cursor-default');
            input.classList.remove('text-blue-400');
          }
        }
      }
    }

    function handleInputChange(input, val) {
      if (mistakes >= maxMistakes) return;
      const [_, r, c] = input.id.split('-').map(Number);
      clearInputStyles(input);
      if (val === solutionBoard[r][c]) {
        input.classList.add('correct-input');
        input.readOnly = true;
        input.classList.add('cursor-default');
        checkCompletion();
      } else {
        input.classList.add('incorrect-input');
        mistakes++;
        mistakesEl.textContent = mistakes;
        secondsElapsed += 3;
        updateTimerDisplay();
        if (mistakes >= maxMistakes) {
          endGameDueToMistakes();
        }
      }
    }

    function checkCompletion() {
      if (mistakes >= maxMistakes) return;
      let complete = true;
      let wrong = false;
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const input = document.getElementById(`cell-${row}-${col}`);
          const val = input.value;
          if (val === '') {
            complete = false;
            input.classList.remove('incorrect-input');
            input.classList.remove('correct-input');
            continue;
          }
          if (parseInt(val) !== solutionBoard[row][col]) {
            wrong = true;
          }
        }
      }
      if (complete && !wrong) {
        clearInterval(timerInterval);
        messageEl.textContent = `ðŸŽ‰ Congratulations! You solved the puzzle in ${formatTime(secondsElapsed)}.`;
        hintBtn.disabled = true;
        disableAllInputs();
      } else {
        messageEl.textContent = '';
      }
    }

    function disableAllInputs() {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const input = document.getElementById(`cell-${row}-${col}`);
          input.readOnly = true;
          input.classList.add('cursor-default');
        }
      }
    }

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60).toString().padStart(2, '0');
      const s = (seconds % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updateTimerDisplay() {
      timerEl.textContent = formatTime(secondsElapsed);
    }

    function startTimer() {
      clearInterval(timerInterval);
      secondsElapsed = 0;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        secondsElapsed++;
        updateTimerDisplay();
      }, 1000);
    }

    function useHint() {
      if (hintsLeft <= 0) return;
      if (mistakes >= maxMistakes) return;
      const emptyCells = [];
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const input = document.getElementById(`cell-${row}-${col}`);
          if (input.value === '') {
            emptyCells.push([row, col]);
          }
        }
      }
      if (emptyCells.length === 0) return;
      const [r, c] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      const input = document.getElementById(`cell-${r}-${c}`);
      input.value = solutionBoard[r][c];
      input.readOnly = true;
      input.classList.add('cursor-default', 'correct-input');
      hintsLeft--;
      hintsLeftEl.textContent = hintsLeft;
      if (hintsLeft === 0) {
        hintBtn.disabled = true;
      }
      checkCompletion();
    }

    function endGameDueToMistakes() {
      clearInterval(timerInterval);
      messageEl.textContent = `âŒ Game Over! You made ${maxMistakes} mistakes. Please try again.`;
      hintBtn.disabled = true;
      disableAllInputs();
    }

    function newGame() {
      messageEl.textContent = '';
      hintsLeft = 3;
      hintsLeftEl.textContent = hintsLeft;
      hintBtn.disabled = false;
      mistakes = 0;
      mistakesEl.textContent = mistakes;
      solutionBoard = generateFullBoard();
      puzzleBoard = generatePuzzle(solutionBoard, 40);
      fillGrid(puzzleBoard);
      startTimer();
    }

    function highlightRelatedCells(focusedInput) {
      clearHighlights();
      if (!focusedInput) return;
      const [_, r, c] = focusedInput.id.split('-').map(Number);
      for (let i = 0; i < 9; i++) {
        if (i !== c) {
          const rowCell = document.getElementById(`cell-${r}-${i}`);
          if (rowCell) {
            rowCell.classList.add('highlight-row');
          }
        }
        if (i !== r) {
          const colCell = document.getElementById(`cell-${i}-${c}`);
          if (colCell) {
            colCell.classList.add('highlight-col');
          }
        }
      }
      const startRow = r - (r % 3);
      const startCol = c - (c % 3);
      for (let rr = startRow; rr < startRow + 3; rr++) {
        for (let cc = startCol; cc < startCol + 3; cc++) {
          if (rr === r && cc === c) continue;
          const boxCell = document.getElementById(`cell-${rr}-${cc}`);
          if (boxCell) {
            if (!boxCell.classList.contains('highlight-row') && !boxCell.classList.contains('highlight-col')) {
              boxCell.classList.add('highlight-box');
            }
          }
        }
      }
    }

    function clearHighlights() {
      const inputs = sudokuForm.querySelectorAll('input.sudoku-cell');
      inputs.forEach(input => {
        input.classList.remove('highlight-row', 'highlight-col', 'highlight-box');
      });
    }

    createGrid();
    newGame();

    hintBtn.addEventListener('click', e => {
      e.preventDefault();
      useHint();
    });

    newGameBtn.addEventListener('click', e => {
      e.preventDefault();
      newGame();
      setTimeout(() => {
        focusFirstEmpty();
      }, 100);
    });

    function focusFirstEmpty() {
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const input = document.getElementById(`cell-${row}-${col}`);
          if (!input.readOnly) {
            input.focus();
            return;
          }
        }
      }
    }
  </script>
</body>
</html>